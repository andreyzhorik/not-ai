<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NOT AI ‚Äî GPTS</title>
<style>
  :root{
    --bg:#0a0f1c; --panel:#10182a; --accent:#3b82f6; --accent-soft:#1d4ed8;
    --muted:#94a3b8; --text:#e5eaf5; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.3);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg,var(--bg),#060b17);color:var(--text)}
  .app{width:95%;max-width:900px;height:90vh;background:var(--panel);border-radius:var(--radius);
    box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px;border-bottom:1px solid rgba(255,255,255,0.04)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-soft));
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
  .title{font-weight:700;color:var(--accent)}
  .controls{display:flex;gap:10px;align-items:center}
  select{background:rgba(255,255,255,0.03);color:var(--text);border:1px solid rgba(255,255,255,0.06);
    padding:8px 10px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn{background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .chat{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:12px}
  .msg{max-width:78%;padding:12px 16px;border-radius:12px;line-height:1.5;box-shadow:0 6px 18px rgba(0,0,0,0.3)}
  .msg.user{align-self:flex-end;background:linear-gradient(135deg,var(--accent-soft),var(--accent));color:#fff;border-bottom-right-radius:6px}
  .msg.assistant{align-self:flex-start;background:#111827;color:var(--text);border-bottom-left-radius:6px}
  .msg strong{color:#fff;font-weight:700}
  .msg em{font-style:italic;color:#cbd5e1}
  .msg code{background:#1e293b;padding:2px 5px;border-radius:4px;font-family:monospace;color:#93c5fd}
  .msg pre{background:#1e293b;padding:10px;border-radius:8px;overflow-x:auto;font-family:monospace;color:#93c5fd}
  .msg ul{margin:6px 0;padding-left:20px}
  .msg li{margin:3px 0}
  .meta{font-size:12px;color:var(--muted);margin-top:6px}
  footer{display:flex;gap:10px;padding:14px;border-top:1px solid rgba(255,255,255,0.04);background:#0d1525}
  textarea{flex:1;min-height:56px;border-radius:10px;padding:12px;background:#0c1222;border:1px solid rgba(255,255,255,0.06);color:var(--text);resize:none}
  button.send{background:var(--accent);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer}
  .small{font-size:12px;color:var(--muted)}
  .typing{width:48px;height:18px;border-radius:12px;background:#162037;display:flex;gap:6px;align-items:center;padding:6px}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);animation:blink 1s infinite}
  .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
  @keyframes blink{0%{opacity:.15}50%{opacity:1}100%{opacity:.15}}
  @media (max-width:640px){.app{height:100vh;border-radius:0}}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">N-A</div>
        <div>
          <div class="title">NOT AI</div>
          <div class="small">Private Local Chat</div>
        </div>
      </div>
      <div class="controls">
        <label class="small" for="provider">Model</label>
        <select id="provider"></select>
        <button class="btn" id="clearBtn">Clear</button>
      </div>
    </header>

    <main class="chat" id="chat"></main>

    <footer>
      <textarea id="prompt" placeholder="Type your message..."></textarea>
      <button class="send" id="sendBtn">Send</button>
    </footer>
  </div>

<script>
const primaryURL = "https://plain-pine-b32a1234567890.cloudflareworkers.net"; // your primary worker
const backupURL  = "https://wispy-voice-741d1234567890.cloudflareworkers.net"; // your backup worker
const model = "gpt-4o-mini"; // main AI model name

// === MAIN SEND FUNCTION ===
async function sendToAI(messages) {
  try {
    // --- PRIMARY AI ---
    const primaryRes = await fetch(primaryURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ provider: model, messages }),
    });
    const primaryData = await primaryRes.json();

    // If valid primary reply
    if (primaryData.output_text && !primaryData.output_text.includes("‚ö†Ô∏è No reply")) {
      return { text: primaryData.output_text, source: "primary" };
    }

    // --- BACKUP AI ---
    appendSystem("‚ö†Ô∏è Primary server failed ‚Äî using backup. gpt-4o mini");
    const backupRes = await fetch(backupURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ provider: model, messages }),
    });
    const backupData = await backupRes.json();
    const backupText = backupData.output_text || "‚ö†Ô∏è Backup server returned no reply";

    return { text: backupText, source: "backup" };

  } catch (err) {
    console.error("‚ùå Both servers failed:", err);
    return { text: "‚ùå Both servers failed: " + err.message, source: "error" };
  }
}

// === CHAT INPUT HANDLER ===
async function handleSend() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  appendMessage("user", text);
  input.value = "";

  const aiMsg = appendMessage("ai", "üí≠ Thinking...");

  const messages = [{ role: "user", content: text }];
  const result = await sendToAI(messages);

  aiMsg.textContent = result.text;
}

// === MESSAGE APPEND HELPERS ===
function appendMessage(role, text) {
  const chat = document.getElementById("chat");
  const msg = document.createElement("div");
  msg.className = "msg " + role;
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  return msg;
}

// Adds system messages like ‚Äú‚ö†Ô∏è Primary failed‚Äù
function appendSystem(text) {
  const chat = document.getElementById("chat");
  const sys = document.createElement("div");
  sys.className = "msg system";
  sys.textContent = text;
  chat.appendChild(sys);
  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
